@using HealthPlus.Models
@model List<Patient>
@{
    ViewBag.Title = "Doctor";
}

<link href="~/Content/DataTables/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/DataTables/css/jquery.dataTables.min.css" rel="stylesheet"/>
<link href="~/Scripts/summernote/summernote.css" rel="stylesheet"/>
<link href="~/Content/summernote-list-styles-bs4.css" rel="stylesheet" />
<style>
    .container {
        padding: 35px;
        background-color: #f0ffffa3;
    }
    .ST {
        text-align: center;
        margin-top: 35px;
        font-size: 21px;
        background-color: #cbcbf1;
        padding: 7px;
        font-weight: bold;
  
    }
    .STD {
        width: 8em;
        padding: 7px;
        margin: 5px;
    }
</style>
<div class="">
    <div class="himg">
        <img style="width: 100%; height: 28em;" src="~/Photos/treatment.jpg"/>
    </div>
    <div class="htext">
        <h2>Heal the patient</h2>
        You can manage patient, see their history and much more.
    </div>
    <div class="hblur">

    </div>

</div>
<div class="container">
    <div class="dTitle">
        Patient's List
    </div>
    <table id="datatable" class="table table-bordered table-striped table-hover">
        <thead>
        <tr>
            <td>Serial No.</td>
            <td>Patient's Name</td>
            <td>Age</td>
            <td>History</td>
            <td>Report</td>

            <td>Call</td>
          
        </tr>
        </thead>
        <tbody>
        @{
            int i = 1;
        }
        @foreach (Patient patient in Model)
        {
            string ca = "callbtn"+i;
            <tr id="@i">
                
                <td id="serial">@i</td>
                <td id="name">@patient.Name</td>
                <td id="age">@patient.Age</td>
                <td id="history">@patient.History</td>
                <td id="report">@patient.Report

                    
                </td>

                <td><button id="@ca" style="width: 100%;" class="btn btn-success ttb">Call</button>
                    <div style="height: 0; width: 0; visibility: hidden;" id="PatientId">@patient.Id</div></td>
                
            </tr>


            i++;

        }
        </tbody>
    </table>
    <div class="row" style="margin-top: 40px;">
        <div class="col-md-3">
            <table id="calltbl">
                <tr>
                    <th>Serial : </th>
                    <td >
                        <div id="pserial"></div></td>
                </tr>
                <tr>
                    <th>Name : </th>
                    <td id="pname"></td>
                </tr>
                <tr>
                    <th>Age : </th>
                    <td id="page"></td>
                </tr>
                <tr>
                    <th>History : </th>
                    <td id="phistory"></td>
                </tr>
                <tr>
                    <th>Report : </th>
                    <td id="preport"></td>
                </tr>
                
                <tr>
                    <td>
                        
                        <button style="width: 7em;" class="btn btn-success" id="previous"><i class=" fa fa-arrow-left"> </i><br/>Previous</button>
                    </td>
                  
                    <td><button style="width: 7em;" class="btn btn-success" id="next"><i class=" fa fa-arrow-right"></i><br/>Next</button></td>

                </tr>
            </table>
        </div>
        <div class="col-md-9">
            <form method="POST" >
                <div id="pid" >
                    
                </div>
                <div class="form-group row">
                    <div class="col-sm-1"></div>
                    <label for="Prescript" class="col-sm-2 col-form-label"><b>Prescription</b></label>

                    <div class="col-sm-9">

                        <textarea style="height: 20em;" class="form-control" id="Prescript" name="Prescript" placeholder="Write your prescription"></textarea>
                        <p class="ST">Select Tests</p>
                        <div style="margin-bottom: 16px;">


                            <select name="Tests[]" class="STD">
                                <option value="">Blood Test</option>
                                <option value="CBC">CBC</option>
                                <option value="RCB">RCB</option>
                                <option value="Dengu">Dengu</option>
                                <option value="Suger">Suger</option>
                            </select>
                            <select name="Tests[]" class="STD">
                                <option value="">Heart Test</option>
                                <option value="BCirculer">BCirculer</option>
                                <option value="Kidney">Kidney</option>
                                <option value="Heart">Heart</option>
                                <option value="Bypass">Bypass</option>
                            </select>
                        </div>
                        <button style="width: 100%;" type="submit" class="btn btn-success">Print Prescription</button>
                    </div>
                </div>
            </form>
        </div>

    </div>
</div>

@section scripts
{
    <script src="~/Scripts/DataTables/jquery.dataTables.js"></script>
    <script src="~/Scripts/editor.js"></script>
    <script src="~/Scripts/summernote/summernote.js"></script>
    <script src="~/Scripts/summernote-list-styles-bs4.js"></script>
    <script type="text/javascript">

        $(document).ready(function() {

            $('#Prescript').summernote({
                height: 240,
                foreColor: 'white'


            });

            var table = $('.table').DataTable();


            $('.ttb').on('click', function() {
                $('#prescription').code('');
                $('#pserial').empty();
                $('#pname').empty();
                $('#page').empty();
                $('#phistory').empty();
                $('#preport').empty();
                $('#pid').empty();

                var $row = $(this).closest("tr"),
                    $t = $row.find("td:nth-child(1)").text(),
                    $name = $row.find("td:nth-child(2)").text(),
                    $age = $row.find("td:nth-child(3)").text(),
                    $history = $row.find("td:nth-child(4)").text(),
                    $report = $row.find("td:nth-child(5)").text();
                var idd = $.trim($row.find("td:nth-child(6)").text().substr(4));
                console.log(idd);
                $('#pserial').append($t);
                $('#pname').append($name);
                $('#page').append($age);
                $('#phistory').append($history);
                $('#preport').append($report);
                $('#pid').append('<input type="hidden" name="PatientId" value="' + idd + '">');


                return false;
            });
            $(document).on('click', '#next', function() {

                $('#prescription').code('');

                $('#pname').empty();
                $('#page').empty();
                $('#phistory').empty();
                $('#preport').empty();
                $('#pid').empty();

                var knn = document.getElementById('pserial').innerHTML;

                if (knn === 'No more patient')
                    knn = '0';
                var kn = parseInt(knn);
                var txt = "";

                var $t = table.cell(kn, 0).data();
                var $name = table.cell(kn, 1).data();
                var $age = table.cell(kn, 2).data();
                var $history = table.cell(kn, 3).data();
                var $report = table.cell(kn, 4).data();
                var idd = table.cell(kn, 5).data();
                if (idd != null) {
                    var len = idd.length;

                    for (var i = len - 11; i < len; i++) {
                        if (idd[i] === '>') {
                            while (idd[i + 1] !== '<') {
                                txt = txt + idd[i + 1];
                                i = i + 1;
                            }
                            break;
                        }
                    }
                }
                
                
            
            console.log(txt);
            if (!table.cell(kn, 0).data())
                $t = 'Finished';

            $('#pserial').append($t);

            $('#pserial').empty();
            $('#pserial').append($t);
            $('#pname').append($name);
            $('#page').append($age);
            $('#phistory').append($history);
            $('#preport').append($report);
            $('#pid').append('<input type="hidden" name="PatientId" value="' + txt + '">');


            return false;
        });

        $(document).on('click', '#previous', function() {

            $('#prescription').code('');

            $('#pname').empty();
            $('#page').empty();
            $('#phistory').empty();
            $('#preport').empty();
            $('#pid').empty();

            var knn = document.getElementById('pserial').innerHTML;

            if (knn === 'Finished')
                knn = table.rows().count() + 1;
            else if (knn === 'No more patient')
                knn = 0;

            var kn = parseInt(knn);
            kn = kn - 2;
            var txt = "";

            var t = table.cell(kn, 0).data();
            var name = table.cell(kn, 1).data();
            var age = table.cell(kn, 2).data();
            var history = table.cell(kn, 3).data();
            var report = table.cell(kn, 4).data();
            var idd = table.cell(kn, 5).data();

            if (idd != null) {
                var len = idd.length;

                for (var i = len - 11; i < len; i++) {
                    if (idd[i] === '>') {
                        while (idd[i + 1] !== '<') {
                            txt = txt + idd[i + 1];
                            i = i + 1;
                        }
                        break;
                    }
                }
            }
            console.log(idd);
            console.log(txt);
            if (kn < 0)
                t = 'No more patient';

            $('#pserial').append(t);

            $('#pserial').empty();
            $('#pserial').append(t);
            $('#pname').append(name);
            $('#page').append(age);
            $('#phistory').append(history);
            $('#preport').append(report);
            $('#pid').append('<input type="hidden" name="PatientId" value="'+txt+'">');


            return false;
        });
    });
    </script>
    
}
